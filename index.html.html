<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treino de Fogo - Tracker TAF/Academia (Local)</title>
    <!-- Carrega Tailwind CSS para estiliza√ß√£o e responsividade -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega a fonte Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Cor de fundo clara */
        }
        .scrollable-content {
            /* Fixa o cabe√ßalho e permite que o conte√∫do role */
            /* Ajuste para telas menores: max-h-screen (100% da altura da tela) */
            max-height: calc(100vh - 4rem); 
            overflow-y: auto;
        }
        .timer-button {
            transition: all 0.2s ease-in-out;
        }
        .set-circle {
            /* Fixa o tamanho do c√≠rculo para melhor toque em dispositivos m√≥veis */
            width: 40px; 
            height: 40px;
        }
        /* Estilos de carregamento para visualiza√ß√£o */
        .loading-animation {
            background: linear-gradient(-90deg, #f0f0f0 0%, #e0e0e0 50%, #f0f0f0 100%);
            background-size: 400% 400%;
            animation: shimmer 1.5s infinite linear;
            border-radius: 8px;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>

<!-- L√≥gica Principal do Aplicativo em JS puro -->
<script>
    // Vari√°veis de estado e dados
    let currentDayIndex = new Date().getDay() % 7; // 0=Dom, 1=Seg, ..., 6=S√°b (Default: Dia de hoje)
    let currentWorkout;
    const dayLabels = ['A', 'B', 'C', 'D', 'E', 'F', 'G'];
    
    // Armazena o √∫ltimo desempenho (carga/reps) carregado do localStorage
    let lastPerformanceCache = {}; 
    
    // Estado da Conclus√£o de S√©ries da Sess√£o Atual
    let currentSetStatus = []; 

    // Chave para armazenamento no localStorage
    const STORAGE_KEY = 'workoutLogHistory';
    const CACHE_KEY = 'lastPerformanceCache';

    // Estrutura de Treino (Derivada do Markdown original)
    const workoutPlan = {
        0: { name: 'Treino A: Peito Puxado + TAF (Dom)', exercises: [
            { group: 'PEITO', name: 'Supino Inclinado com Halteres', sets: 4, taf: 'TAF Barra Fixa (3x M√°x. Reps)' },
            { group: 'PEITO', name: 'Crossover na Polia Alta', sets: 4, taf: '' },
            { group: 'PEITO', name: 'Peck Deck / Voador', sets: 4, taf: '' },
            { group: 'TR√çCEPS', name: 'Tr√≠ceps Corda na Polia Alta', sets: 4, taf: '' },
            { group: 'TR√çCEPS', name: 'Tr√≠ceps Franc√™s Halteres (Sentado)', sets: 4, taf: '' },
            { group: 'ABD√îMEN', name: 'Abdominal M√°quina (Crunch)', sets: 4, taf: '' }
        ]},
        1: { name: 'Treino B: Costas Pesado + B√≠ceps (Seg)', exercises: [
            { group: 'COSTAS', name: 'Puxada Alta (Pegada Pronada Aberta)', sets: 4, taf: '' },
            { group: 'COSTAS', name: 'Remada Curvada com Barra (Pegada Pronada)', sets: 4, taf: '' },
            { group: 'COSTAS', name: 'Remada na Polia Baixa (Tri√¢ngulo/Fechada)', sets: 4, taf: '' },
            { group: 'B√çCEPS', name: 'Rosca Direta com Barra (W ou Reta)', sets: 4, taf: '' },
            { group: 'B√çCEPS', name: 'Rosca Martelo com Halteres (Alternada)', sets: 4, taf: '' },
            { group: 'TRAP√âZIO', name: 'Encolhimento com Halteres (Em P√©)', sets: 4, taf: '' }
        ]},
        2: { name: 'Treino C: Pernas Foco Quadr√≠ceps + TAF (Ter)', exercises: [
            { group: 'QUADR√çCEPS', name: 'Agachamento Livre / Hack Machine', sets: 4, taf: 'TAF Barra Fixa (3x M√°x. Reps)' },
            { group: 'QUADR√çCEPS', name: 'Leg Press 45¬∫ (P√©s Baixos)', sets: 4, taf: '' },
            { group: 'QUADR√çCEPS', name: 'Cadeira Extensora', sets: 4, taf: '' },
            { group: 'POSTERIOR', name: 'Cadeira Flexora', sets: 4, taf: '' },
            { group: 'PANTURRILHA', name: 'Eleva√ß√£o de Panturrilha em P√©', sets: 4, taf: '' }
        ]},
        3: { name: 'Treino D: Ombros Completo + Core (Qua)', exercises: [
            { group: 'OMBRO', name: 'Desenvolvimento Militar (Halteres ou M√°quina)', sets: 4, taf: '' },
            { group: 'OMBRO', name: 'Eleva√ß√£o Lateral com Cabo (Unilateral)', sets: 4, taf: '' },
            { group: 'OMBRO', name: 'Crucifixo Inverso na M√°quina', sets: 4, taf: '' },
            { group: 'TR√çCEPS', name: 'Tr√≠ceps Coice (Unilateral)', sets: 4, taf: '' },
            { group: 'B√çCEPS', name: 'Rosca Scott (M√°quina ou Banco)', sets: 4, taf: '' },
            { group: 'ABD√îMEN', name: 'Prancha (M√°x. Tempo)', sets: 4, taf: '' }
        ]},
        4: { name: 'Treino E: Push Leve / Peito Leve + TAF (Qui)', exercises: [
            { group: 'PEITO', name: 'Supino Reto M√°quina (ou Halteres)', sets: 4, taf: 'TAF Barra Fixa (3x M√°x. Reps)' },
            { group: 'PEITO', name: 'Flex√£o de Bra√ßo (at√© a Falha)', sets: 4, taf: '' },
            { group: 'OMBRO', name: 'Eleva√ß√£o Frontal com Halteres', sets: 4, taf: '' },
            { group: 'TR√çCEPS', name: 'Tr√≠ceps Pulley V invertido', sets: 4, taf: '' },
            { group: 'TR√çCEPS', name: 'Tr√≠ceps Paralelas (m√°quina assistida)', sets: 4, taf: '' },
            { group: 'PANTURRILHA', name: 'Eleva√ß√£o de Panturrilha Sentado', sets: 4, taf: '' }
        ]},
        5: { name: 'Treino F: Pernas Foco Posterior e Gl√∫teo (Sex)', exercises: [
            { group: 'POSTERIOR', name: 'Stiff com Halteres', sets: 4, taf: '' },
            { group: 'POSTERIOR', name: 'Mesa Flexora (Deitado)', sets: 4, taf: '' },
            { group: 'GL√öTEO', name: 'Eleva√ß√£o P√©lvica (Hip Thrust)', sets: 4, taf: '' },
            { group: 'QUADR√çCEPS', name: 'Cadeira Extensora (Unilateral)', sets: 4, taf: '' },
            { group: 'PANTURRILHA', name: 'Eleva√ß√£o de Panturrilha no Leg Press', sets: 4, taf: '' },
            { group: 'ABD√îMEN', name: 'Rota√ß√£o de Tronco (M√°quina/Cabo)', sets: 4, taf: '' }
        ]},
        6: { name: 'Treino G: Bra√ßos Foco Isola√ß√£o + Complementar (S√°b)', exercises: [
            { group: 'B√çCEPS', name: 'Rosca Concentrada (Sentado)', sets: 4, taf: '' },
            { group: 'B√çCEPS', name: 'Rosca Inversa (Barra/Cabo)', sets: 4, taf: '' },
            { group: 'B√çCEPS', name: 'Rosca 21 (Varia√ß√£o de Amplitude)', sets: 4, taf: '' },
            { group: 'TR√çCEPS', name: 'Tr√≠ceps Testa com Barra W', sets: 4, taf: '' },
            { group: 'TR√çCEPS', name: 'Extens√£o de Tr√≠ceps Acima da Cabe√ßa (Corda)', sets: 4, taf: '' },
            { group: 'ANTEBRA√áO', name: 'Rosca de Punho (Palma para Cima)', sets: 4, taf: '' },
            { group: 'ANTEBRA√áO', name: 'Rosca de Punho (Palma para Baixo)', sets: 4, taf: '' },
            { group: 'ABD√îMEN', name: 'Eleva√ß√£o de Pernas (Pendurado ou Deitado)', sets: 4, taf: '' }
        ]}
    };

    /**
     * Carrega o cache de √∫ltimo desempenho do localStorage.
     */
    function loadCacheFromLocalStorage() {
        try {
            const cachedData = localStorage.getItem(CACHE_KEY);
            if (cachedData) {
                lastPerformanceCache = JSON.parse(cachedData);
            } else {
                lastPerformanceCache = {};
            }
        } catch (e) {
            console.error("Erro ao carregar cache do localStorage:", e);
            lastPerformanceCache = {};
        }
    }

    /**
     * Salva o cache de √∫ltimo desempenho no localStorage.
     */
    function saveCacheToLocalStorage() {
        try {
            localStorage.setItem(CACHE_KEY, JSON.stringify(lastPerformanceCache));
        } catch (e) {
            console.error("Erro ao salvar cache no localStorage:", e);
            window.showCustomAlert('Erro de Armazenamento', 'N√£o foi poss√≠vel salvar o hist√≥rico localmente. Verifique as permiss√µes do navegador.');
        }
    }

    /**
     * Atualiza o cache de desempenho com os dados de um novo log de treino.
     * @param {Array} newExercisesLog - Array de objetos de exerc√≠cios com 'name', 'load' e 'reps'.
     */
    function updatePerformanceCache(newExercisesLog) {
        newExercisesLog.forEach(log => {
            // Atualiza o cache se o novo desempenho for melhor/mais recente.
            // Aqui, apenas substitu√≠mos pelo log mais recente, assumindo que foi salvo.
            lastPerformanceCache[log.name] = {
                reps: log.reps,
                load: log.load
            };
        });
        saveCacheToLocalStorage();
    }


    /**
     * Alterna o status de conclus√£o de uma s√©rie e atualiza a UI.
     * @param {number} exIndex - √çndice do exerc√≠cio.
     * @param {number} setIndex - √çndice da s√©rie (0 a 3).
     */
    window.toggleSetCompletion = (exIndex, setIndex) => {
        if (currentSetStatus[exIndex] && setIndex < currentSetStatus[exIndex].length) {
            // Alterna o estado
            const isCompleted = currentSetStatus[exIndex][setIndex];
            currentSetStatus[exIndex][setIndex] = !isCompleted;
            
            // Atualiza a apar√™ncia do bot√£o no DOM
            const button = document.querySelector(`#setBtn-${exIndex}-${setIndex}`);
            if (button) {
                if (isCompleted) {
                    // Se estava completo, torna incompleto
                    button.classList.remove('bg-red-600', 'text-white');
                    button.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                } else {
                    // Se estava incompleto, torna completo
                    button.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                    button.classList.add('bg-red-600', 'text-white');
                }
            }
        }
    };

    /**
     * Alterna o dia de treino atual e renderiza a UI.
     * @param {number} newIndex - O √≠ndice do novo dia de treino (0=A, 6=G).
     */
    function changeWorkoutDay(newIndex) {
        newIndex = parseInt(newIndex);
        if (newIndex >= 0 && newIndex <= 6 && newIndex !== currentDayIndex) {
            currentDayIndex = newIndex;
            currentWorkout = workoutPlan[currentDayIndex];
            
            // Inicializa o status das s√©ries para o novo treino (todas incompletas)
            currentSetStatus = currentWorkout.exercises.map(ex => 
                Array(ex.sets).fill(false)
            );
            
            highlightSelectedDay();
            renderWorkout();
        }
    }
    window.changeWorkoutDay = changeWorkoutDay; // Exp√µe para uso nos bot√µes HTML

    /**
     * Renderiza os bot√µes do seletor de dias A-G.
     */
    function renderDaySelector() {
        const selectorContainer = document.getElementById('daySelector');
        selectorContainer.innerHTML = dayLabels.map((label, index) => `
            <button id="dayBtn-${index}" onclick="window.changeWorkoutDay(${index})"
                class="flex-1 py-1 px-1 text-xs font-bold rounded-lg transition duration-150 ease-in-out">
                ${label}
            </button>
        `).join('');
        highlightSelectedDay(); // Define a cor inicial do bot√£o
    }
    
    /**
     * Atualiza o estilo do bot√£o de dia de treino selecionado.
     */
    function highlightSelectedDay() {
        dayLabels.forEach((_, index) => {
            const btn = document.getElementById(`dayBtn-${index}`);
            if (btn) {
                 if (index === currentDayIndex) {
                    btn.className = 'flex-1 py-1 px-1 text-xs font-bold rounded-lg transition duration-150 ease-in-out bg-white text-red-700 shadow-inner';
                } else {
                    btn.className = 'flex-1 py-1 px-1 text-xs font-bold rounded-lg transition duration-150 ease-in-out bg-red-600 hover:bg-red-500 text-white opacity-70';
                }
            }
        });
    }

    /**
     * Renderiza o treino do dia (A-G) na interface.
     */
    function renderWorkout() {
        const workoutContainer = document.getElementById('workoutContainer');
        const header = document.getElementById('workoutHeader');

        header.textContent = currentWorkout.name;
        workoutContainer.innerHTML = '';

        currentWorkout.exercises.forEach((ex, index) => {
            const lastPerf = lastPerformanceCache[ex.name];
            const lastReps = lastPerf ? lastPerf.reps : '-';
            const lastLoad = lastPerf ? lastPerf.load : '-';
            
            // Gera o HTML dos c√≠rculos de sets
            const setCirclesHTML = currentSetStatus[index].map((isCompleted, setIdx) => `
                <button id="setBtn-${index}-${setIdx}" onclick="window.toggleSetCompletion(${index}, ${setIdx})"
                    class="set-circle w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold transition duration-150 ease-in-out shadow-lg
                    ${isCompleted ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}"
                    aria-label="Set ${setIdx + 1} Completion">
                    ${setIdx + 1}
                </button>
            `).join('');

            const exerciseHTML = `
                <div class="bg-white p-4 rounded-xl shadow-md mb-4 border-l-4 border-red-600">
                    <h3 class="text-xl font-bold text-gray-800 mb-2 flex justify-between items-center">
                        <span>${index + 1}. ${ex.name}</span>
                        <span class="text-sm font-semibold text-red-600">${ex.group}</span>
                    </h3>
                    
                    <!-- C√≠rculos de Conclus√£o de S√©ries -->
                    <div class="flex space-x-2 mb-4 justify-between">
                        ${setCirclesHTML}
                    </div>

                    <!-- √öltimo Desempenho (Recorde) -->
                    <div class="text-xs text-gray-500 mb-3 p-2 bg-red-50 rounded-lg">
                        <p class="font-semibold">√öltimo Recorde (Carga/Reps):</p>
                        <p class="font-mono text-base text-red-700">${lastLoad}kg / ${lastReps} Reps</p>
                    </div>

                    <!-- Detalhes e TAF -->
                    <p class="text-sm text-gray-600 mb-3">
                        <span class="font-semibold">S√©ries:</span> ${ex.sets} | 
                        <span class="font-semibold">Foco:</span> ${ex.taf || 'Ativa√ß√£o M√°xima'}
                    </p>

                    <!-- Inputs para Reps e Carga ATUAL -->
                    <div class="flex space-x-2 mt-4">
                        <input type="number" id="reps-${index}" data-id="${index}" data-type="reps" placeholder="Reps (Atual)" class="w-1/2 p-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 text-sm" required>
                        <input type="number" id="load-${index}" data-id="${index}" data-type="load" placeholder="Carga (kg)" class="w-1/2 p-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 text-sm" required>
                    </div>
                </div>
            `;
            workoutContainer.insertAdjacentHTML('beforeend', exerciseHTML);
        });

        // Adiciona o bot√£o de salvar no final
        workoutContainer.insertAdjacentHTML('beforeend', `
            <button id="saveWorkoutBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition duration-150 ease-in-out mt-6" onclick="window.saveWorkoutLog()">
                Finalizar Treino e Salvar Log
            </button>
        `);
    }

    /**
     * Salva o log do treino atual no LocalStorage e atualiza o cache.
     */
    window.saveWorkoutLog = () => {
        const workoutLog = {
            date: new Date().toISOString(),
            dayName: currentWorkout.name,
            workoutDayId: currentDayIndex,
            exercises: []
        };
        
        let allInputsFilled = true;
        let allSetsCompleted = true; 
        const newExercisesLog = [];

        currentWorkout.exercises.forEach((ex, index) => {
            const repsInput = document.getElementById(`reps-${index}`);
            const loadInput = document.getElementById(`load-${index}`);

            const reps = parseInt(repsInput.value);
            const load = parseFloat(loadInput.value);
            
            // 1. Checagem de Inputs
            if (isNaN(reps) || isNaN(load) || reps <= 0 || load < 0) {
                repsInput.classList.add('border-yellow-500', 'ring-2');
                loadInput.classList.add('border-yellow-500', 'ring-2');
                allInputsFilled = false;
                // N√£o retorna aqui para que todos os campos vazios sejam marcados
                return;
            } else {
                repsInput.classList.remove('border-yellow-500', 'ring-2');
                loadInput.classList.remove('border-yellow-500', 'ring-2');
            }

            // 2. Checagem de Conclus√£o de S√©ries
            const setsCompleted = currentSetStatus[index].every(status => status === true);
            if (!setsCompleted) {
                allSetsCompleted = false;
            }

            // Prepara o log da s√©rie
            const setsLog = currentSetStatus[index].map((status, setIdx) => ({
                set: setIdx + 1,
                completed: status
            }));

            const exerciseLog = {
                name: ex.name,
                group: ex.group,
                sets: ex.sets,
                reps: reps,
                load: load,
                restTime: '120s',
                setsStatus: setsLog
            };
            workoutLog.exercises.push(exerciseLog);
            newExercisesLog.push(exerciseLog); // Para atualizar o cache
        });

        if (!allInputsFilled) {
            window.showCustomAlert('Aten√ß√£o', 'Por favor, preencha Repeti√ß√µes e Cargas v√°lidas para todos os exerc√≠cios antes de salvar.');
            return;
        }
        
        if (!allSetsCompleted) {
            window.showCustomAlert('Aten√ß√£o', 'Voc√™ deve marcar *todas* as s√©ries (c√≠rculos 1 a 4) como conclu√≠das para todos os exerc√≠cios antes de salvar o treino.');
            return;
        }

        try {
            // 1. Salva o Log Completo (Opcional, mas mant√©m um registro)
            const existingLogs = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            existingLogs.push(workoutLog);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(existingLogs));

            // 2. Atualiza o Cache de Desempenho (Essencial para a renderiza√ß√£o)
            updatePerformanceCache(newExercisesLog);

            // 3. Sucesso e Re-renderiza√ß√£o
            // Reinicializa o status das s√©ries para a nova sess√£o
            currentSetStatus = currentWorkout.exercises.map(ex => Array(ex.sets).fill(false)); 
            renderWorkout();
            
            window.showCustomAlert('Sucesso!', 'Log de treino salvo localmente. Seus novos recordes est√£o definidos!');
        } catch (e) {
            console.error("Erro ao salvar o log no LocalStorage:", e);
            window.showCustomAlert('Erro', 'N√£o foi poss√≠vel salvar o log. Verifique o console para detalhes.');
        }
    };


    // --- L√≥gica do Timer de Descanso ---
    let timerInterval = null;
    let timeRemaining = 120; // 2 minutos em segundos
    let timerDisplay, timerBtn, timerResetBtn; // Definidos em setupRestTimer

    function setupRestTimer() {
        // Obter refer√™ncias DOM aqui, dentro de uma fun√ß√£o chamada por window.onload
        timerDisplay = document.getElementById('timerDisplay');
        timerBtn = document.getElementById('timerButton');
        timerResetBtn = document.getElementById('timerResetButton');
        
        if (timerBtn && timerResetBtn) {
            timerBtn.onclick = toggleTimer;
            timerResetBtn.onclick = resetTimer;
            updateTimerDisplay(); // Garante o display inicial
        }
    }

    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function updateTimerDisplay() {
        if (!timerDisplay) return;

        timerDisplay.textContent = formatTime(timeRemaining);
        
        // Atualiza a cor de fundo do bot√£o baseado no tempo
        if (timeRemaining <= 10) {
             // Opcional: Atualizar a cor aqui se o timer estiver rodando
        } 
        // A cor de fundo do bot√£o √© gerenciada principalmente pelo toggleTimer para indicar o estado
    }

    function toggleTimer() {
        if (timerInterval) {
            // Pausa
            clearInterval(timerInterval);
            timerInterval = null;
            timerBtn.textContent = 'INICIAR DESCanso (2:00)';
            timerBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600', 'bg-red-600');
            timerBtn.classList.add('bg-green-500', 'hover:bg-green-600');
        } else {
            // Inicia
            if (timeRemaining === 0) {
                timeRemaining = 120; // Reseta se j√° tiver terminado
            }
            timerBtn.textContent = 'PAUSAR DESCanso';
            timerBtn.classList.remove('bg-green-500', 'hover:bg-green-600', 'bg-red-600');
            timerBtn.classList.add('bg-yellow-500', 'hover:bg-yellow-600');

            timerInterval = setInterval(() => {
                if (timeRemaining > 0) {
                    timeRemaining--;
                    updateTimerDisplay();
                } else {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    timerBtn.textContent = 'DESCANSO CONCLU√çDO!';
                    timerBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600', 'bg-green-500');
                    timerBtn.classList.add('bg-red-600');
                    window.showCustomAlert('Aten√ß√£o', 'Seu tempo de descanso de 2 minutos terminou. Hora de voltar √† a√ß√£o!');
                }
            }, 1000);
        }
    }

    function resetTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
        timeRemaining = 120;
        updateTimerDisplay();
        timerBtn.textContent = 'INICIAR DESCanso (2:00)';
        timerBtn.classList.remove('bg-yellow-500', 'bg-red-600');
        timerBtn.classList.add('bg-green-500', 'hover:bg-green-600');
    }


    // --- L√≥gica do Modal/Alerta Personalizado (Substitui alert()) ---
    window.showCustomAlert = (title, message) => {
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalMessage').textContent = message;
        document.getElementById('customAlertModal').classList.remove('hidden');
    };

    /**
     * Configura os listeners do modal, garantindo que o DOM est√° carregado.
     */
    function setupModalListeners() {
        const closeModalButton = document.getElementById('closeModalButton');
        if (closeModalButton) {
            closeModalButton.onclick = () => {
                document.getElementById('customAlertModal').classList.add('hidden');
            };
        }
    }


    /**
     * Fun√ß√£o principal de inicializa√ß√£o.
     */
    function initializeApp() {
        // 1. Carrega dados persistentes (se houver)
        loadCacheFromLocalStorage();

        // 2. Define o treino inicial e o status das s√©ries
        currentWorkout = workoutPlan[currentDayIndex];
        currentSetStatus = currentWorkout.exercises.map(ex => Array(ex.sets).fill(false)); 
        
        // 3. Configura a UI
        renderDaySelector();
        setupRestTimer(); // Chama setupRestTimer() que pega os elementos DOM
        setupModalListeners(); // Chama setupModalListeners() que pega os elementos DOM
        
        // 4. Renderiza o conte√∫do (usando o cache carregado)
        renderWorkout(); 

        document.getElementById('loadingIndicator').classList.add('hidden');
        document.getElementById('userIdDisplay').textContent = `ID do Usu√°rio: LocalStorage (Aut√¥nomo)`;
        document.getElementById('saveWorkoutBtn').textContent = 'Finalizar Treino e Salvar Log Localmente';
    }

    // Inicia o app ao carregar a janela
    window.onload = initializeApp;

</script>

<!-- Estrutura Principal do App -->
<div class="min-h-screen bg-gray-100 flex flex-col">

    <!-- Header Fixo (Informa o Treino do Dia) -->
    <header class="bg-red-700 text-white p-4 shadow-lg sticky top-0 z-10 rounded-b-xl">
        <h1 class="text-2xl font-extrabold mb-1">üî• Treinamento Bombeiro (Aut√¥nomo)</h1>
        
        <!-- Seletor de Dia de Treino (A-G) -->
        <div id="daySelector" class="flex justify-between space-x-1 mb-3">
            <!-- Buttons A to G ser√£o renderizados aqui pelo JS -->
        </div>

        <h2 id="workoutHeader" class="text-xl font-bold bg-red-800 p-2 rounded-lg text-center">Carregando...</h2>
        <p id="userIdDisplay" class="text-xs mt-1 opacity-75">ID do Usu√°rio: Carregando...</p>
    </header>

    <!-- Indicador de Carregamento (Breve) -->
    <div id="loadingIndicator" class="text-center p-4 text-red-600 font-semibold loading-animation">
        Inicializando App Local...
    </div>

    <!-- Conte√∫do Principal do Treino (Rol√°vel) -->
    <main class="flex-grow p-4 scrollable-content">
        
        <!-- Timer de Descanso Integrado -->
        <section class="bg-gray-800 text-white p-4 rounded-xl shadow-2xl mb-6 flex flex-col sm:flex-row items-center justify-between gap-4">
            <div class="flex flex-col items-center">
                <p class="text-lg font-bold mb-2 text-red-400">Tempo de Descanso (2 Minutos)</p>
                <div id="timerDisplay" class="text-6xl font-extrabold font-mono">02:00</div>
            </div>
            <div class="flex flex-col gap-2 w-full sm:w-auto">
                <button id="timerButton" class="timer-button w-full sm:w-48 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl shadow-md">
                    INICIAR DESCanso (2:00)
                </button>
                <button id="timerResetButton" class="w-full sm:w-48 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 rounded-xl text-sm">
                    Reiniciar
                </button>
            </div>
        </section>

        <!-- Lista de Exerc√≠cios -->
        <section id="workoutContainer" class="mt-4">
            <!-- Exerc√≠cios ser√£o renderizados aqui pelo JS -->
        </section>

    </main>
</div>

<!-- Modal/Alerta Personalizado (Substitui alert()) -->
<div id="customAlertModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden z-50">
    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4">
        <h3 id="modalTitle" class="text-xl font-bold mb-3 text-red-600">T√≠tulo</h3>
        <p id="modalMessage" class="text-gray-700 mb-4">Mensagem</p>
        <button id="closeModalButton" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded-lg transition duration-150">
            Entendido
        </button>
    </div>
</div>

</body>
</html>